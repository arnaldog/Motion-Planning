\section{Descripción del Algoritmo}

%%% REPRESENTACION PARA EL ENJAMBRE
	
El enjambre de partículas corresponde al conjunto de $S$ partículas, donde partícula es una eventual solución y corresponde a una ruta a la que se le calcula una velocidad de movimiento respecto a su mejor posición histórica y respecto a la mejor posición global determinada la inicialización y posteriormente determinado durante la iteración.
El objetivo del Global Path Planning PSO es que cada partícula tome movimientos relativos al mejor del grupo y a su propia información de mejor posición.


	\begin{enumerate}
	\item El mapa está representado como una matriz  con coeficientes binarios
	\[Map = \left[
		\begin{array}{ccc}
		(1,1)  & \cdots & (1, m) \\
		\vdots & \ddots & \vdots \\
		(n, 1) & \cdots & (n, m)  \\
		\end{array}\right]
	\]

	\item Una partícula corresponde a una solución del problema, es decir una ruta $r$ de longitud $l$
	\[ r = \{ (p_{1x}, p_{1y}) , \cdots, ( p_{lx}, p_{ly}) \}, \quad |r| = l \]
	\item Todas las combinaciones de rutas posibles dentro del mapa representan el dominio de cada ruta
	\item La longitud de $k$ la velocidad es fija, y cada punto se calcula con $k$ incrementos de
		   $ \delta = \lfloor l/k \rfloor$ sobre la ruta $p$.
	\[ v = \{ (p_{\delta x}, p_{\delta y}) , \cdots, ( p_{k\delta x}, p_{k \delta y}) \}, \quad |v| = k  \]
	\end{enumerate}
	
	Representación
	\begin{enumerate}
	\item Cada ruta $p$ será construida pseudo aleatoreamente 
	\item La velocidad de la partícula en el inicio corresponderá a sus pivotes
	\item Para evaluar la velocidad entre las partículas se actualizan los pivotes de las
		  velocidades en vez de la posición.	
    \item La actualización de la posición corresponde a la generación de nuevas rutas
    	  que pasen por los pivotes antes calculados.
	\end{enumerate}
	
	Función objetivo
	\begin{equation}
		\min F(r) = lenght(r) + C(1 + lenght(r)^\alpha)
	\end{equation}
	
	\begin{enumerate}
	\item $lenght(r)$ es el largo de la ruta
	\item $ C$ es el número de colisiones
	\item $\alpha$ es el nivel de penalización por rutas cortas con colisiones
	\end{enumerate}
	
	{Posición y velocidad de la partícula}
	\begin{eqnarray}
		r = \{ p_1, \ldots, p_l \} \\
		v = \{ v_1, \ldots, v_k \} 
	\end{eqnarray}
	
	\begin{enumerate}
	\item La ruta $r$ se vá generando pseudo aleatoreamente 
	\item Por ende, todas las rutas tienen largos distintos.
	\item Sin embargo, la longitud del vector velocidad es constante dado como parámetro
	\item En este caso difiere respecto a la velocidad respecto a la del PSO original.
	\end{enumerate}
	
	{Actualizacíon de velocidad y posición de la partícula}
	\begin{eqnarray}
	 v_{i+1} = \omega v_i + \rho_g\phi_g (g - x_i) + \rho_p\phi_g (p_i- x_i) \\
	  r_{i+1} =  r_i +  v_i 
	\end{eqnarray}
	
	Los parámetros son:
	\begin{enumerate} 
	\item $\omega$ que pondera el efecto de la velocidad actual
	\item $\phi_g$ parámetro para favorecer la explotación
	\item $\phi_p$ parámetro para favorecer la exploración
	\item $\rho_g, \rho_p \sim U(0,1)$
	\item $g$ la mejor posición global
	\item $p_i$ la mejor posición de la partícula $i$
	\item $r_i$ posición de la partícula $i$ (la ruta $i$).
	\end{enumerate}
	
	{Actualizacíon de velocidad y posición de la partícula}
	\begin{eqnarray}
	 v_{i+1} = \omega v_i + \rho_g\phi_g (v(g) - v(r_i)) + \rho_p\phi_g (v(p_i) - v(r_i)) \\
	  r_{i+1} = \text{Construir ruta a partir de }v^{t+1}
	\end{eqnarray}
	
	Se calculan las diferencias entre los pivotes (velocidades)
	\begin{enumerate} 
	\item $v(g) - v(r_i)$, la velocidad se calcula como
	\item $v(p_i) - v(r_i)$ 
	\end{enumerate}
	Donde la velocidad corresponde a un punto en el plano con componentes $x,y$
	\begin{eqnarray}
		v_x &=& \omega v_i_x + \rho_g\phi_g (v(g_x) - v(r_x)) + \rho_p\phi_g (v(p_x) - v(r_x)) \\
		v_y &=& \omega v_i_x + \rho_g\phi_g (v(g_y) - v(r_y)) + \rho_p\phi_g (v(p_y) - v(r_y))
	\end{eqnarray}

%%%% OPERADORES DE RUTA


%%% ALGORITMO PSO
Inicialización del enjambre
\begin{algorithm}[H]% <- necesario
\SetLine \KwData{$S, \omega, \Phi_g, \Phi_p$}
\KwResult{Mejor particula $s_i$. }
\linesnumbered
\SetVline
\For{$i=1$ \KwTo $S$ }
{
	$r_i = $ \text{Inicializar posicion aleatoreamente}\;
	$p_i \leftarrow r_i$\;
	$v_i = $ \text{Inicializar velocidad aleatoreamente}\;
	\If{$f(p_i) < f(g)$}{
		$g \leftarrow p_i$
	}
	
}
\end{algorithm}

Iteración del enjambre
\begin{algorithm}[H]% <- necesario
\SetLine \KwData{$S, \omega, \Phi_g, \Phi_p, I$}
\KwResult{Mejor particula $g$. }
\linesnumbered
$i = 0$
\While{$ i < I $}{
	\For{$i=1$ \KwTo $S$}
	{
		$ r_p, r_g \sim U(0,1)$\;
		$ v_i \leftarrow \omega v_i + \Phi_p r_p (p_i - r_i) + \Phi_g r_g(g - r_i)$\;
		$ x_i \leftarrow x_i + v_i $\;
		\If{$ f(r_i) < f(p_i)$}
		{
			$p_i \leftarrow r_i$\;
			\If{$f(p_i) < f(g)$}
			{
				$g \leftarrow p_i$\;
			}
		}
	}
	$i=i+1$\;
}
\Return $g$ \;
\end{algorithm}